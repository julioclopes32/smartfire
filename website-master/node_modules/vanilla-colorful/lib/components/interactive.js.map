{"version":3,"file":"interactive.js","sourceRoot":"","sources":["../../src/lib/components/interactive.ts"],"names":[],"mappings":"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","sourcesContent":["import { createTemplate, createRoot } from '../utils/dom.js';\nimport { clamp } from '../utils/math.js';\nimport styles from '../styles/interactive.js';\n\nexport interface Interaction {\n  left: number;\n  top: number;\n}\n\nexport interface InteractiveInterface {\n  setStyles(properties: Record<string, string>): void;\n}\n\nconst template = createTemplate(\n  `<style>${styles}</style><div id=\"interactive\"><div part=\"pointer\"></div></div>`\n);\n\nlet hasTouched = false;\n\n// Check if an event was triggered by touch\nconst isTouch = (e: Event): e is TouchEvent => 'touches' in e;\n\n// Prevent mobile browsers from handling mouse events (conflicting with touch ones).\n// If we detected a touch interaction before, we prefer reacting to touch events only.\nconst isValid = (event: Event): boolean => {\n  if (hasTouched && !isTouch(event)) return false;\n  if (!hasTouched) hasTouched = isTouch(event);\n  return true;\n};\n\nconst fireMove = (target: Interactive, interaction: Interaction, key?: boolean): void => {\n  target.dispatchEvent(\n    new CustomEvent('move', {\n      bubbles: true,\n      detail: target.getMove(interaction, key)\n    })\n  );\n};\n\nconst pointerMove = (target: Interactive, event: Event): void => {\n  const pointer = isTouch(event) ? event.touches[0] : (event as MouseEvent);\n  const rect = target.getBoundingClientRect();\n\n  fireMove(target, {\n    left: clamp((pointer.pageX - (rect.left + window.pageXOffset)) / rect.width),\n    top: clamp((pointer.pageY - (rect.top + window.pageYOffset)) / rect.height)\n  });\n};\n\nconst keyMove = (target: Interactive, event: KeyboardEvent): void => {\n  // We use `keyCode` instead of `key` to reduce the size of the library.\n  const keyCode = event.keyCode;\n  // Ignore all keys except arrow ones, Page Up, Page Down, Home and End.\n  if (keyCode > 40 || (target.xy && keyCode < 37) || keyCode < 33) return;\n  // Do not scroll page by keys when color picker element has focus.\n  event.preventDefault();\n  // Send relative offset to the parent component.\n  fireMove(\n    target,\n    {\n      left:\n        keyCode === 39 // Arrow Right\n          ? 0.01\n          : keyCode === 37 // Arrow Left\n          ? -0.01\n          : keyCode === 34 // Page Down\n          ? 0.05\n          : keyCode === 33 // Page Up\n          ? -0.05\n          : keyCode === 35 // End\n          ? 1\n          : keyCode === 36 // Home\n          ? -1\n          : 0,\n      top:\n        keyCode === 40 // Arrow down\n          ? 0.01\n          : keyCode === 38 // Arrow Up\n          ? -0.01\n          : 0\n    },\n    true\n  );\n};\n\nexport abstract class Interactive extends HTMLElement implements InteractiveInterface {\n  pointer!: CSSStyleDeclaration;\n\n  constructor() {\n    super();\n    this.pointer = (createRoot(this, template).querySelector(\n      '[part=pointer]'\n    ) as HTMLElement).style;\n    this.addEventListener('mousedown', this);\n    this.addEventListener('touchstart', this);\n    this.addEventListener('keydown', this);\n    this.setAttribute('role', 'slider');\n    this.setAttribute('tabindex', '0');\n  }\n\n  set dragging(state: boolean) {\n    const toggleEvent = state ? document.addEventListener : document.removeEventListener;\n    toggleEvent(hasTouched ? 'touchmove' : 'mousemove', this);\n    toggleEvent(hasTouched ? 'touchend' : 'mouseup', this);\n  }\n\n  handleEvent(event: Event): void {\n    switch (event.type) {\n      case 'mousedown':\n      case 'touchstart':\n        event.preventDefault();\n        // event.button is 0 in mousedown for left button activation\n        if (!isValid(event) || (!hasTouched && (event as MouseEvent).button != 0)) return;\n        pointerMove(this, event);\n        this.dragging = true;\n        break;\n      case 'mousemove':\n      case 'touchmove':\n        event.preventDefault();\n        pointerMove(this, event);\n        break;\n      case 'mouseup':\n      case 'touchend':\n        this.dragging = false;\n        break;\n      case 'keydown':\n        keyMove(this, event as KeyboardEvent);\n        break;\n    }\n  }\n\n  abstract getMove(interaction: Interaction, key?: boolean): Record<string, number>;\n\n  abstract get xy(): boolean;\n\n  setStyles(properties: Record<string, string>): void {\n    for (const p in properties) {\n      this.pointer.setProperty(p, properties[p]);\n    }\n  }\n}\n"]}